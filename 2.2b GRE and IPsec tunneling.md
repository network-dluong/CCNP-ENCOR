### GRE  
* tunneling protocol that provides connectivity to a wide variety of network-layer protocols by encapsulating and forwarding packets over an IP-based network  
* Can be used to tunnel traffic through firewall, an ACL, or to connect discontinuous networks, and as networking duct tape for bad routing designs  
1. Create tunnel interface:  
> **interface tunnel (*tunnel-number*)**  
2. Identify local source of tunnel: 
> **tunnel source {*ip-address* | *interface-id*}**  
  * Tunnel source interface indicates the interface that will be used for encapsulation and de-encapsulation of GRE tunnel  
  * Source can be physical interface or loopback  
3. Identify remote destination IP address:  
> **tunnel destination (*ip-address*)**  
  * Tunnel destination is the remote router’s underlay IP address toward which local router sends packets  
4. Allocate IP address to tunnel interface  
> **ip address (*ip-address*) (*subnet-mask*)**  
5. (Optional) define tunnel bandwidth in kilobits per second:  
> **bandwidth [*1-10000000*]**
  * Virtual interfaces do not have concept of latency and need to have reference bandwidth so routing protocols that use bandwidth for best-path calculation can make intelligent decisions  
6.	(Optional) specify GRE tunnel keepalive: 
> **keepalive [*seconds* [*retries*]]**
  * Tunnel interfaces are GRE P2P by default, and line protocol enters an “up” state when router detects that a route to tunnel destination exists in routing table  
  * If tunnel destination is not in table, interface enters “down” state  
  * Keepalives ensure bidirectional communication exists between tunnel endpoints to keep line protocol up  
  * Default timer is 10 seconds with 3 retries  
7.	(Optional) define IP MTU:  
> **ip mtu (*mtu*)**
  * Tunnel adds minimum of 24 bytes to packet size to accommodate the headers that are added to packet  
  * It will have the router perform the fragmentation in advance of the host having to detect and specify the packet MTU  
  
  
> **show interface (*tunnel-number*)**  
* GRE without IPsec = 24 bytes  
* DES/3DES IPsec (transport mode) = 18-25 bytes  
* DES/3DES IPsec (tunnel mode) = 38-45 bytes  
* GRE + Des/3DES = 42-49 bytes  
* GRE + AES + SHA-1 = 62-77 bytes  
* Recursive routing and outbound interface selection are two common problems with tunnel or overlay networks  
  * To remediate, prevent the tunnel endpoint address from being advertised across the tunnel network  
  

### IPsec  
* framework of open standards for creating highly secure VPNs using various protocols and technologies for secure communication across unsecure networks (Internet)  
* Uses two different packet headers to deliver security services: Authentication Header and Encapsulating Security Payload (ESP)  
* Authentication Header – provides data integrity, authentication, and protection from hackers replaying packets  
  * Ensures that original data packet (before encapsulation) has not been modified during transport on public network  
  * Creates a digital signature like checksum, using protocol number 51 located in IP header  
  * Does not support encryption (data confidentiality) and NAT traversal (NAT-T)  
* ESP – provides data confidentiality, authentication, and protection from hackers replaying packets  
  * Payload is the portion of the original packet that is encapsulated within the IPsec headers  
  * Ensures that original payload (before encapsulation) maintains data confidentiality by encrypting the payload and adding new set of headers during transport across public network  
  * Uses protocol number 50  
  * Supports encryption and NAT-T  


* Traditional IPsec provides two modes of packet transport: Tunnel and Transport  
* Tunnel mode – encrypts entire original packet and adds new set of IPsec headers. These new headers are used to route packet and provide overlay functions  
* Transport mode – encrypts and authenticates only the packet payload. Does not provide overlay functions and routes based on original IP headers  
  * Data Encryption Standard (DES) - 56-bit symmetric data encryption algorithm that can encrypt data sent over VPN, very weak do not use  
  * Triple DES (3DES) - runs DES 3 times with 3 different 56-bit keys  
  * Advanced Encryption Standard (AES) - symmetric encryption algorithm, supports key lengths of 128 bits, 192 bits or 256 bits and based on Rijndael algorithm  
  * Message Digest 5 (MD5) - one-way 128-bit hash algorithm used for data authentication. Cisco devices use MD5 HMAC, provides additional levels of protection against MitM attacks  
  * Secure Hash Algorithm (SHA) - one-way 160-bit hash algorithm used for data authentication. Provides additional protection against MitM attacks  
  * Diffie-Hellman (DH) - asymmetric key exchange protocol that enables two peers to establish a shared secret key over an unsecure communications channel  
    * DH group refers to length of the key (modulus size) to use for a DH key exchange  
    * Larger modulus = more secure. Generates shared secret symmetric keys that are used by two VPN peers for symmetrical algorithms  
    * Avoid DH groups 1, 2 and 5; use DH groups 14+  
  * RSA signatures – public-key (digital certificates) cryptographic system used to mutually authenticate peers  
  * Pre-Shared Key – security mechanism in which a locally configured key is used as a credential to mutually authenticate peers  


* Transform set – combination of security protocols and algorithms  
* Internet Key Exchange (IKE) - protocol that performs authentication between two endpoints to establish security associations (SAs), known as IKE tunnels. Tunnels are used to carry control plane and data plane traffic for IPsec. Two versions of IKE: IKEv1 and IKEv2  
* Internet Security Association Key Management Protocol (ISAKMP) - framework for authentication and key exchange between two peers to establish, modify, and tear down SAs. Uses UDP port 500  


### IKEv1  
* two phases of key negotiation for IKE and IPsec SA establishment:
1. Phase 1 – establishes bidirectional SA between two IKE peers (ISAKMP SA). Either peer may initiate negotiations for phase 2  
* Main mode – six message exchanges. Slower than aggressive mode, but more secure and flexible because it offers an IKE peer more security proposals. MM1 - MM6  
* Aggressive mode – three message exchange and less time to negotiate keys between peers. Less secure, exposed to eavesdropping. AM1, AM2, AM3  
 2. Phase 2 – establishes unidirectional IPsec SAs, leveraging ISAKMP SA established in phase 1 for the negotiation  
* Quick mode – three message exchange: QM1, QM2, QM3  
*  Perfect Forward Secrecy (PFS) - optional, requires additional DH exchanges that require additional CPU cycles. Greater resistance to crypto attacks and maintain privacy of IPsec tunnels by deriving session keys independently of any previous key  


### IKEv2
* communications consist of request and response pairs called exchanges (request/response pairs)  
* Takes four messages instead of six (aggressive) or nine (main)  
* Increased efficiency, Elliptic Curve Digital Signature Algorithm (ECDSA-SIG), Extensible Authentication Protocol (EAP), Next Generation Encryption (ENG), Asymmetric Authentication  
  * IKE_SA_INIT – same as IKEv1 first two pairs of messages MM1 to MM4 but done as a single request/response pair  
  * IKE_AUTH – same as IKEv1 MM5 to MM6, or QM1 and QM2, but done as a single request/response pair  


> [*Back*](https://github.com/network-dluong/CCNP-ENCOR/tree/2.0-Virtualization)

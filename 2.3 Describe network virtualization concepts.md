### Overlay network  
* logical/virtual network built over a physical transport network (underlay)  
* Enables network virtualization, segmentation, and security to make traditional networks more manageable, flexible, secure (encryption), and scalable  
* GRE, IPsec, LISP, VXLAN, MPLS  


### VPN  
* overlay network that allows private networks to communicate with each other across an untrusted network such as the Internet (IPsec)  
* MPLS tunneling is not supported across the Internet unless it is tunneled within another tunneling protocol (GRE), which can then be encrypted with IPsec  
* Overlay tunnel can be built over another overlay tunnel  
  * Site-to-Site (LAN-to-LAN) IPsec VPNs - allows multivendor interoperability, but difficult to manage in large networks  
  * Cisco Dynamic Multipoint VPN (DMVPN) - combines multipoint GRE (mGRE) tunnels, IPsec, and Next Hop Resolution Protocol (NHRP)  
  * Cisco Group Encrypted Transport VPN (GET VPN) - for enterprises to build any-to-any tunnel-less VPNs across SP MPLS networks or private WANs. Does not affect existing MPLS private WAN network services (multicast, QoS)  
  * Cisco FlexVPN – unified VPN solution that combines site-to-site, remote access, hub-and-spoke topologies and partial meshes. Extensively uses virtual access interfaces while remaining compatible with legacy VPN implementations using crypto maps  
  * Remote VPN Access – allows remote users to securely VPN into corporate network  
  

### Site-to-Site GRE over IPsec  
* use crypto maps or tunnel IPsec profiles  
1. Configure crypto ACL to classify VPN traffic:  
> **ip access-list extended (*acl_name*)**  
> **permit gre host {*tunnel-source IP*} host {*tunnel-destination IP*}**  
2. Configure ISAKMP policy for IKE SA:  
> **crypto isakmp policy (*priority*)**  
> **encryption ()**  
> **hash ()**  
> **authentication ()**  
> **group ()**  
3. Configure PSK:  
> **crypto isakmp key (*keystring*) address (*peer-address*) [*mask*]**  
4. Create transform set and enter configuration mode:  
> **crypto ipsec transform-set (*name*) {transform1 [2..3..]; mode [tunnel | transport]}**  
5. Configure crypto map and enter configuration:  
> **crypto map (*name*) (*seq-num*) [ipsec-isakmp]**  
6. Apply crypto map to outside interface:  
> **crypto map (*name*)**  
* Configure an ISAKMP policy for IKE SA:  
> **crypto isakmp policy (*priority*)**  
* Configure PSK:  
> **crypto isakmp key (*keystring*) address (*peer-address*) [*mask*]**  
* Create transform set:  
> **crypto ipsec transform-set (*name*) (transform1..2..); mode [tunnel | transport]**  
* Create IPsec profile:  
> **crypto ipsec profile (*name*); set transform-set (*name*)**  
* Apply IPsec profile to tunnel interface:  
> **tunnel protection (*ipsec profile name*)**  


### Site-to-Site VTI over IPsec  
* change packet transport mode to tunnel mode  
* Steps are like Site-to-Site GRE over IPsec  
  * Difference is under the GRE tunnel interface to enable VTI and change packet transport mode to tunnel mode:  
  > **tunnel mode ipsec {ipv4 | ipv6}**  
  * To revert to GRE over IPsec:  
  > **tunnel mode gre {ipv4 | ipv6}**  


> [*Back*](https://github.com/network-dluong/CCNP-ENCOR/tree/2.0-Virtualization)  
